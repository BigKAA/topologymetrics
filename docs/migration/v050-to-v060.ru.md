*[English version](v050-to-v060.md)*

# Миграция с v0.5.0 на v0.6.0

Руководство по миграции Go SDK на версию v0.6.0.

> Этот релиз затрагивает **только Go SDK**. Java, Python и C# SDK остаются на v0.5.0.

## Что изменилось

Пакет `checks` разделён на отдельные подпакеты. Каждый чекер теперь находится
в своём пакете внутри `dephealth/checks/`:

| Старое (v0.5.0) | Новое (v0.6.0) |
| --- | --- |
| `checks.HTTPChecker` | `httpcheck.Checker` |
| `checks.GRPCChecker` | `grpccheck.Checker` |
| `checks.TCPChecker` | `tcpcheck.Checker` |
| `checks.PostgresChecker` | `pgcheck.Checker` |
| `checks.MySQLChecker` | `mysqlcheck.Checker` |
| `checks.RedisChecker` | `redischeck.Checker` |
| `checks.AMQPChecker` | `amqpcheck.Checker` |
| `checks.KafkaChecker` | `kafkacheck.Checker` |

---

## Нужно ли менять код?

**Если вы используете `dephealth.New()` с URL-конфигурацией** (рекомендуемый
подход) — **изменения не требуются**. Blank-импорт по-прежнему работает:

```go
import _ "github.com/BigKAA/topologymetrics/sdk-go/dephealth/checks"
```

**Если вы используете типы чекеров напрямую** (например `checks.NewHTTPChecker()`)
— код продолжит компилироваться благодаря обратно совместимым алиасам в
`checks/compat.go`. Однако старые имена помечены как deprecated и будут удалены
в будущих версиях.

---

## Выборочный импорт (новая возможность)

Теперь можно импортировать только нужные чекеры, уменьшая размер бинарника:

```go
// v0.5.0 — все чекеры (по-прежнему работает)
import _ "github.com/BigKAA/topologymetrics/sdk-go/dephealth/checks"

// v0.6.0 — только HTTP и Postgres
import (
    _ "github.com/BigKAA/topologymetrics/sdk-go/dephealth/checks/httpcheck"
    _ "github.com/BigKAA/topologymetrics/sdk-go/dephealth/checks/pgcheck"
)
```

Доступные подпакеты:

| Пакет | Тип |
| --- | --- |
| `checks/tcpcheck` | TCP |
| `checks/httpcheck` | HTTP |
| `checks/grpccheck` | gRPC |
| `checks/pgcheck` | PostgreSQL |
| `checks/mysqlcheck` | MySQL |
| `checks/redischeck` | Redis |
| `checks/amqpcheck` | AMQP (RabbitMQ) |
| `checks/kafkacheck` | Kafka |

---

## Миграция прямого использования чекеров

Если вы используете типы чекеров напрямую, обновите импорты на подпакеты:

```go
// v0.5.0
import "github.com/BigKAA/topologymetrics/sdk-go/dephealth/checks"

checker := checks.NewHTTPChecker(
    checks.WithHealthPath("/ready"),
    checks.WithTLSEnabled(true),
)

// v0.6.0
import "github.com/BigKAA/topologymetrics/sdk-go/dephealth/checks/httpcheck"

checker := httpcheck.New(
    httpcheck.WithHealthPath("/ready"),
    httpcheck.WithTLSEnabled(true),
)
```

### Изменения имён опций

Некоторые имена опций упрощены (префикс типа чекера больше не нужен):

| Старое имя | Новое имя |
| --- | --- |
| `WithHTTPTLSSkipVerify` | `httpcheck.WithTLSSkipVerify` |
| `WithGRPCTLS` | `grpccheck.WithTLS` |
| `WithGRPCTLSSkipVerify` | `grpccheck.WithTLSSkipVerify` |
| `WithGRPCBearerToken` | `grpccheck.WithBearerToken` |
| `WithGRPCBasicAuth` | `grpccheck.WithBasicAuth` |
| `WithPostgresDB` | `pgcheck.WithDB` |
| `WithPostgresDSN` | `pgcheck.WithDSN` |
| `WithPostgresQuery` | `pgcheck.WithQuery` |
| `WithMySQLDB` | `mysqlcheck.WithDB` |
| `WithMySQLDSN` | `mysqlcheck.WithDSN` |
| `WithMySQLQuery` | `mysqlcheck.WithQuery` |
| `WithRedisClient` | `redischeck.WithClient` |
| `WithRedisPassword` | `redischeck.WithPassword` |
| `WithRedisDB` | `redischeck.WithDB` |
| `WithAMQPURL` | `amqpcheck.WithURL` |

---

## Пакеты contrib/

Пакеты `contrib/sqldb` и `contrib/redispool` обновлены для использования
подпакетов. **Изменения в пользовательском коде не требуются**.
