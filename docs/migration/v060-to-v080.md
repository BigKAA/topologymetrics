*[Русская версия](v060-to-v080.ru.md)*

# Migration from v0.6.0 to v0.8.0

Migration guide for Java, Python, and C# SDKs from v0.6.0 to v0.8.0.

> For Go SDK migration from v0.7.0 to v0.8.0, see
> [v0.7.0 to v0.8.0](v070-to-v080.md).

## What Changed

New LDAP health checker with full protocol support added to all SDKs:

| Feature | Description |
| --- | --- |
| Check methods | `anonymous_bind`, `simple_bind`, `root_dse` (default), `search` |
| Protocols | `ldap://` (port 389), `ldaps://` (port 636), StartTLS |
| TLS options | `startTLS`, `tlsSkipVerify` |
| Pool mode | Accept existing LDAP connection for health checks |

---

## Do I Need to Change My Code?

**No.** This is a fully backward-compatible release. All existing code
continues to work without modification.

---

## New Feature: LDAP Health Checker

### Java

```java
import biz.kryukov.dev.dephealth.checks.LdapHealthChecker;
import biz.kryukov.dev.dephealth.checks.LdapHealthChecker.CheckMethod;

// RootDSE check (default)
var checker = LdapHealthChecker.builder()
    .checkMethod(CheckMethod.ROOT_DSE)
    .build();

// Simple bind with credentials over LDAPS
var checker = LdapHealthChecker.builder()
    .checkMethod(CheckMethod.SIMPLE_BIND)
    .bindDN("cn=monitor,dc=corp,dc=com")
    .bindPassword("secret")
    .useTLS(true)
    .build();

// Search with StartTLS
var checker = LdapHealthChecker.builder()
    .checkMethod(CheckMethod.SEARCH)
    .baseDN("dc=example,dc=com")
    .searchFilter("(objectClass=organizationalUnit)")
    .searchScope(LdapHealthChecker.LdapSearchScope.ONE)
    .startTLS(true)
    .build();
```

### Python

```python
from dephealth.checks.ldap import LdapChecker, LdapCheckMethod, LdapSearchScope

# RootDSE check (default)
checker = LdapChecker(check_method=LdapCheckMethod.ROOT_DSE)

# Simple bind with credentials over LDAPS
checker = LdapChecker(
    check_method=LdapCheckMethod.SIMPLE_BIND,
    bind_dn="cn=monitor,dc=corp,dc=com",
    bind_password="secret",
    use_tls=True,
)

# Search with StartTLS
checker = LdapChecker(
    check_method=LdapCheckMethod.SEARCH,
    base_dn="dc=example,dc=com",
    search_filter="(objectClass=organizationalUnit)",
    search_scope=LdapSearchScope.ONE,
    start_tls=True,
)
```

### C\#

```csharp
using DepHealth.Checks;

// RootDSE check (default)
var checker = new LdapChecker(checkMethod: LdapCheckMethod.RootDse);

// Simple bind with credentials over LDAPS
var checker = new LdapChecker(
    checkMethod: LdapCheckMethod.SimpleBind,
    bindDN: "cn=monitor,dc=corp,dc=com",
    bindPassword: "secret",
    useTls: true);

// Search with StartTLS
var checker = new LdapChecker(
    checkMethod: LdapCheckMethod.Search,
    baseDN: "dc=example,dc=com",
    searchFilter: "(objectClass=organizationalUnit)",
    searchScope: LdapSearchScope.One,
    startTls: true);
```

---

## Error Classification

All SDKs classify LDAP errors consistently:

| Condition | Status | Detail |
| --- | --- | --- |
| Check succeeded | `ok` | `ok` |
| LDAP code 49 (Invalid Credentials) | `auth_error` | `auth_error` |
| LDAP code 50 (Insufficient Access Rights) | `auth_error` | `auth_error` |
| TLS/StartTLS failure | `tls_error` | `tls_error` |
| Connection refused | `connection_error` | `connection_refused` |
| DNS resolution failed | `dns_error` | `dns_error` |
| Timeout | `timeout` | `timeout` |
| Server down/busy/unavailable | `unhealthy` | `unhealthy` |

---

## Configuration Validation

| Condition | Error |
| --- | --- |
| `simple_bind` without credentials (`bindDN` + `bindPassword`) | Config error |
| `search` without `baseDN` | Config error |
| `startTLS=true` with `ldaps://` | Config error (incompatible) |
