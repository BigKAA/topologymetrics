name: "ldap-basic"
description: "LDAP зависимости: rootdse, bind, search — healthy; invalid-auth — auth_error"

checks:
  - type: expected_dependencies
    dependencies:
      - dependency: ldap-rootdse
        type: ldap
        host: ldap.dephealth-conformance.svc
        port: 3389
        name: conformance-service
        critical: "no"
        value: 1
      - dependency: ldap-bind
        type: ldap
        host: ldap.dephealth-conformance.svc
        port: 3389
        name: conformance-service
        critical: "no"
        value: 1
      - dependency: ldap-search
        type: ldap
        host: ldap.dephealth-conformance.svc
        port: 3389
        name: conformance-service
        critical: "no"
        value: 1
      - dependency: ldap-invalid-auth
        type: ldap
        host: ldap.dephealth-conformance.svc
        port: 3389
        name: conformance-service
        critical: "no"
        value: 0

  - type: expected_status
    endpoints:
      - dependency: ldap-rootdse
        host: ldap.dephealth-conformance.svc
        port: 3389
        status: ok
      - dependency: ldap-bind
        host: ldap.dephealth-conformance.svc
        port: 3389
        status: ok
      - dependency: ldap-search
        host: ldap.dephealth-conformance.svc
        port: 3389
        status: ok
      - dependency: ldap-invalid-auth
        host: ldap.dephealth-conformance.svc
        port: 3389
        status: auth_error

  - type: expected_detail
    endpoints:
      - dependency: ldap-rootdse
        host: ldap.dephealth-conformance.svc
        port: 3389
        detail: ok
      - dependency: ldap-bind
        host: ldap.dephealth-conformance.svc
        port: 3389
        detail: ok
      - dependency: ldap-search
        host: ldap.dephealth-conformance.svc
        port: 3389
        detail: ok
      - dependency: ldap-invalid-auth
        host: ldap.dephealth-conformance.svc
        port: 3389
        detail: auth_error
