name: "health-details"
description: "HealthDetails() API returns correct endpoint data for all 12 dependencies"

checks:
  # Wait for all dependencies to be healthy before checking /health-details
  - type: expected_dependencies
    dependencies:
      - dependency: postgres-primary
        type: postgres
        host: postgres-primary.dephealth-conformance.svc
        port: 5432
        value: 1
      - dependency: postgres-replica
        type: postgres
        host: postgres-replica.dephealth-conformance.svc
        port: 5432
        value: 1
      - dependency: redis-cache
        type: redis
        host: redis.dephealth-conformance.svc
        port: 6379
        value: 1
      - dependency: rabbitmq
        type: amqp
        host: rabbitmq.dephealth-conformance.svc
        port: 5672
        value: 1
      - dependency: kafka-main
        type: kafka
        host: kafka.dephealth-conformance.svc
        port: 9092
        value: 1
      - dependency: http-service
        type: http
        host: http-stub.dephealth-conformance.svc
        port: 8080
        value: 1
      - dependency: http-auth-bearer
        type: http
        host: http-stub.dephealth-conformance.svc
        port: 8080
        value: 1
      - dependency: http-auth-basic
        type: http
        host: http-stub.dephealth-conformance.svc
        port: 8080
        value: 1
      - dependency: http-auth-header
        type: http
        host: http-stub.dephealth-conformance.svc
        port: 8080
        value: 1
      - dependency: http-auth-wrong
        type: http
        host: http-stub.dephealth-conformance.svc
        port: 8080
        value: 1
      - dependency: grpc-service
        type: grpc
        host: grpc-stub.dephealth-conformance.svc
        port: 9090
        value: 1
      - dependency: grpc-auth-bearer
        type: grpc
        host: grpc-stub.dephealth-conformance.svc
        port: 9090
        value: 1

  - type: health_details_endpoint_exists

  - type: health_details_structure

  - type: health_details_types

  - type: health_details_status_values

  - type: health_details_consistency

  - type: health_details_expected
    endpoints:
      - dependency: postgres-primary
        host: postgres-primary.dephealth-conformance.svc
        port: 5432
        healthy: true
        status: ok
        detail: ok
        type: postgres
        name: postgres-primary
        critical: true
      - dependency: postgres-replica
        host: postgres-replica.dephealth-conformance.svc
        port: 5432
        healthy: true
        status: ok
        detail: ok
        type: postgres
        name: postgres-replica
        critical: false
      - dependency: redis-cache
        host: redis.dephealth-conformance.svc
        port: 6379
        healthy: true
        status: ok
        detail: ok
        type: redis
        name: redis-cache
        critical: true
      - dependency: rabbitmq
        host: rabbitmq.dephealth-conformance.svc
        port: 5672
        healthy: true
        status: ok
        detail: ok
        type: amqp
        name: rabbitmq
        critical: false
      - dependency: kafka-main
        host: kafka.dephealth-conformance.svc
        port: 9092
        healthy: true
        status: ok
        detail: ok
        type: kafka
        name: kafka-main
        critical: false
      - dependency: http-service
        host: http-stub.dephealth-conformance.svc
        port: 8080
        healthy: true
        status: ok
        detail: ok
        type: http
        name: http-service
        critical: false
      - dependency: http-auth-bearer
        host: http-stub.dephealth-conformance.svc
        port: 8080
        healthy: true
        status: ok
        detail: ok
        type: http
        name: http-auth-bearer
        critical: false
      - dependency: http-auth-basic
        host: http-stub.dephealth-conformance.svc
        port: 8080
        healthy: true
        status: ok
        detail: ok
        type: http
        name: http-auth-basic
        critical: false
      - dependency: http-auth-header
        host: http-stub.dephealth-conformance.svc
        port: 8080
        healthy: true
        status: ok
        detail: ok
        type: http
        name: http-auth-header
        critical: false
      - dependency: http-auth-wrong
        host: http-stub.dephealth-conformance.svc
        port: 8080
        healthy: true
        status: ok
        detail: ok
        type: http
        name: http-auth-wrong
        critical: false
      - dependency: grpc-service
        host: grpc-stub.dephealth-conformance.svc
        port: 9090
        healthy: true
        status: ok
        detail: ok
        type: grpc
        name: grpc-service
        critical: false
      - dependency: grpc-auth-bearer
        host: grpc-stub.dephealth-conformance.svc
        port: 9090
        healthy: true
        status: ok
        detail: ok
        type: grpc
        name: grpc-auth-bearer
        critical: false
