name: "full-failure"
description: "Redis полностью недоступен — метрика = 0"

pre_actions:
  - type: scale
    kind: deployment
    name: redis
    replicas: 0
  - type: wait
    seconds: 30

checks:
  - type: status_health_consistency

  - type: expected_status
    endpoints:
      - dependency: redis-cache
        host: redis.dephealth-conformance.svc
        port: 6379
        status: connection_error

  - type: expected_detail
    endpoints:
      - dependency: redis-cache
        host: redis.dephealth-conformance.svc
        port: 6379
        detail: connection_refused

  - type: expected_dependencies
    dependencies:
      - dependency: redis-cache
        type: redis
        host: redis.dephealth-conformance.svc
        port: 6379
        name: conformance-service
        critical: "yes"
        value: 0

post_actions:
  - type: scale
    kind: deployment
    name: redis
    replicas: 1
