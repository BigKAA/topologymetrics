# Scrape-конфигурация VictoriaMetrics для dephealth.
# Монтируется как ConfigMap в VictoriaMetrics.
apiVersion: v1
kind: ConfigMap
metadata:
  name: victoriametrics-config
  namespace: dephealth-monitoring
  labels:
    app: victoriametrics
data:
  scrape.yml: |
    global:
      scrape_interval: 15s
      scrape_timeout: 10s

    scrape_configs:
      # Тестовый Go-сервис dephealth (namespace dephealth-test)
      - job_name: dephealth-test-go
        static_configs:
          - targets:
              - go-service.dephealth-test.svc:8080
            labels:
              namespace: dephealth-test
              service: go-service

      # Conformance test-service (namespace dephealth-conformance)
      # Раскомментировать при запуске conformance-тестов:
      # - job_name: dephealth-conformance
      #   static_configs:
      #     - targets:
      #         - test-service.dephealth-conformance.svc:8080
      #       labels:
      #         namespace: dephealth-conformance
      #         service: test-service

      # Тестовый Python-сервис (namespace dephealth-test)
      - job_name: dephealth-test-python
        static_configs:
          - targets:
              - python-service.dephealth-test.svc:8080
            labels:
              namespace: dephealth-test
              service: python-service

      # Тестовый Java-сервис (namespace dephealth-test)
      - job_name: dephealth-test-java
        metrics_path: /actuator/prometheus
        static_configs:
          - targets:
              - java-service.dephealth-test.svc:8080
            labels:
              namespace: dephealth-test
              service: java-service

      # Тестовый C#-сервис (namespace dephealth-test)
      # Раскомментировать после реализации C# SDK:
      # - job_name: dephealth-test-csharp
      #   static_configs:
      #     - targets:
      #         - csharp-service.dephealth-test.svc:8080
      #       labels:
      #         namespace: dephealth-test
      #         service: csharp-service

      # VictoriaMetrics self-monitoring
      - job_name: victoriametrics
        static_configs:
          - targets:
              - localhost:8428
