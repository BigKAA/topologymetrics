{
  "__inputs": [],
  "__requires": [
    {
      "type": "grafana",
      "id": "grafana",
      "name": "Grafana",
      "version": "9.0.0"
    },
    {
      "type": "datasource",
      "id": "prometheus",
      "name": "Prometheus",
      "version": "1.0.0"
    }
  ],
  "annotations": {
    "list": []
  },
  "description": "Общее здоровье сервисов — клик по плитке открывает детали",
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 0,
  "id": null,
  "links": [
    {
      "asDropdown": false,
      "icon": "arrow-left",
      "includeVars": false,
      "keepTime": true,
      "tags": [],
      "targetBlank": false,
      "title": "Обзор зависимостей",
      "type": "link",
      "url": "/d/dephealth-overview/dephealth-overview"
    },
    {
      "asDropdown": false,
      "icon": "apps",
      "includeVars": false,
      "keepTime": true,
      "tags": [],
      "targetBlank": false,
      "title": "Карта зависимостей",
      "type": "link",
      "url": "/d/dephealth-dependency-map/"
    }
  ],
  "panels": [
    {
      "title": "",
      "type": "stat",
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "gridPos": { "h": 24, "w": 24, "x": 0, "y": 0 },
      "fieldConfig": {
        "defaults": {
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "red", "value": null },
              { "color": "green", "value": 1 }
            ]
          },
          "color": { "mode": "thresholds" },
          "mappings": [
            {
              "type": "value",
              "options": {
                "0": { "text": "DEGRADED" },
                "1": { "text": "HEALTHY" }
              }
            }
          ],
          "links": [
            {
              "title": "Детали сервиса →",
              "url": "/d/dephealth-service-detail/dephealth3a-detali-servisa?var-service=${__series.name}&${__url_time_range}",
              "targetBlank": false
            }
          ]
        },
        "overrides": []
      },
      "options": {
        "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
        "orientation": "auto",
        "textMode": "value_and_name",
        "colorMode": "background",
        "graphMode": "none",
        "justifyMode": "center",
        "wideLayout": true
      },
      "targets": [
        {
          "expr": "min by (job, namespace) (app_dependency_health{namespace=~\"$namespace\"})",
          "legendFormat": "{{job}}",
          "refId": "A"
        }
      ]
    }
  ],
  "refresh": "30s",
  "schemaVersion": 38,
  "tags": ["dephealth", "services", "overview"],
  "templating": {
    "list": [
      {
        "name": "DS_PROMETHEUS",
        "type": "datasource",
        "query": "prometheus",
        "current": {},
        "hide": 0,
        "label": "Datasource"
      },
      {
        "name": "namespace",
        "type": "query",
        "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
        "query": "label_values(app_dependency_health, namespace)",
        "refresh": 2,
        "includeAll": true,
        "allValue": ".*",
        "multi": true,
        "current": { "selected": true, "text": "All", "value": "$__all" },
        "hide": 0,
        "label": "Namespace"
      }
    ]
  },
  "time": { "from": "now-1h", "to": "now" },
  "timepicker": {},
  "timezone": "",
  "title": "dephealth: Сервисы",
  "uid": "dephealth-services",
  "version": 1
}
